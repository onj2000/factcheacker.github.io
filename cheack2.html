<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SNSã‚³ãƒ¡ãƒ³ãƒˆ ãƒªã‚¹ã‚¯åˆ†æãƒ„ãƒ¼ãƒ«</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+JP:wght@400;600;700&display=swap');
    body { font-family: 'Inter', 'Noto Sans JP', sans-serif; background-color: #f7f9fb; }
    .container-box { box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
    .classification-tag { padding: 4px 12px; border-radius: 9999px; font-weight: 600; font-size: 0.875rem; display: inline-block; }
    .color-safe { background-color: #dcfce7; color: #166534; }
    .color-slander { background-color: #fef9c3; color: #854d0e; }
    .color-fake { background-color: #ffedd5; color: #9a3412; }
    .color-crime { background-color: #fee2e2; color: #991b1b; }
    .color-bot { background-color: #f3e8ff; color: #6b21a8; }
    .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3b82f6; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
    @keyframes spin { 0%{transform:rotate(0)} 100%{transform:rotate(360deg)} }
    .api-link { color: #2563eb; font-weight: 500; }
    .api-link:hover { text-decoration: underline; color: #1e40af; }
  </style>
</head>
<body class="p-4 sm:p-8 min-h-screen">
  <div class="max-w-4xl mx-auto">
    <header class="mb-8">
      <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-900 mb-2">SNSã‚³ãƒ¡ãƒ³ãƒˆ ãƒªã‚¹ã‚¯åˆ†æãƒ„ãƒ¼ãƒ«</h1>
      <p class="text-gray-600">Google Gemini ã¾ãŸã¯ OpenAI GPTã‚’ä½¿ã„ã€SNSã‚³ãƒ¡ãƒ³ãƒˆã‚’çŠ¯ç½ªãƒ»èª¹è¬—ä¸­å‚·ãƒ»èª¤æƒ…å ±ãªã©ã«åˆ†é¡ã—ã¾ã™ã€‚</p>
    </header>

    <details class="bg-blue-50 border border-blue-200 p-6 rounded-xl mb-8 container-box">
      <summary class="text-lg font-bold text-blue-800 cursor-pointer">ğŸ”‘ APIã‚­ãƒ¼ã®å–å¾—ã¨æ–™é‡‘ã«ã¤ã„ã¦</summary>
      <div class="mt-4 space-y-4 text-gray-700 border-t border-blue-200 pt-4">
        <h3 class="text-xl font-semibold">Gemini APIã‚­ãƒ¼</h3>
        <ul class="list-disc ml-4">
          <li><a href="https://ai.google.dev/gemini-api/docs/api-key" target="_blank" class="api-link">Google AI Studio</a></li>
          <li><a href="https://ai.google.dev/pricing" target="_blank" class="api-link">æ–™é‡‘ãƒšãƒ¼ã‚¸</a></li>
        </ul>
        <h3 class="text-xl font-semibold">OpenAI APIã‚­ãƒ¼</h3>
        <ul class="list-disc ml-4">
          <li><a href="https://platform.openai.com/account/api-keys" target="_blank" class="api-link">OpenAI Platform</a></li>
          <li><a href="https://openai.com/pricing" target="_blank" class="api-link">æ–™é‡‘ãƒšãƒ¼ã‚¸</a></li>
        </ul>
      </div>
    </details>

    <div class="bg-white p-6 sm:p-8 rounded-xl container-box mb-8">
      <h2 class="text-xl font-bold text-gray-800 mb-4">åˆ†æè¨­å®š</h2>
      <label for="model-select" class="block text-sm font-semibold text-gray-700 mb-2">AIãƒ¢ãƒ‡ãƒ«</label>
      <select id="model-select" class="w-full p-3 border border-gray-300 rounded-lg mb-4">
        <option value="gemini">Google Gemini</option>
        <option value="openai-4o">OpenAI GPT-4o</option>
        <option value="openai-3.5">OpenAI GPT-3.5</option>
      </select>
      <label id="key-label" class="block text-sm font-semibold text-gray-700 mb-2">APIã‚­ãƒ¼</label>
      <input id="api-key-input" type="password" placeholder="sk-ã¾ãŸã¯ AIã‚­ãƒ¼ã‚’å…¥åŠ›" class="w-full p-3 border border-gray-300 rounded-lg mb-6" />
      <label class="block text-lg font-semibold text-gray-700 mb-3">ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›</label>
      <textarea id="comment-input" rows="4" class="w-full p-4 border border-gray-300 rounded-lg" placeholder="ä¾‹: ã‚ã®ä¼šç¤¾ã¯æ˜æ—¥å€’ç”£ã™ã‚‹ã€‚ã“ã‚Œã¯å†…éƒ¨æƒ…å ±ã ã€‚"></textarea>
      <button id="analyze-button" onclick="analyzeComment()" class="mt-4 w-full sm:w-auto px-6 py-3 bg-blue-600 text-white font-bold rounded-lg flex items-center justify-center disabled:opacity-50">
        <div id="button-text">ã‚³ãƒ¡ãƒ³ãƒˆã‚’åˆ†æã™ã‚‹</div>
        <div id="loading-spinner" class="hidden loader ml-2"></div>
      </button>
    </div>

    <div id="results-area" class="hidden bg-white p-6 sm:p-8 rounded-xl container-box">
      <h2 class="text-2xl font-bold text-gray-800 mb-4">åˆ†æçµæœ</h2>
      <div class="mb-4"><span class="text-gray-600 font-medium mr-2">åˆ†é¡:</span><span id="classification-display" class="classification-tag"></span></div>
      <div class="mb-6">
        <h3 class="text-xl font-semibold text-gray-700 mb-2">æ ¹æ‹ </h3>
        <div id="reasoning-display" class="text-gray-800 p-4 bg-gray-50 rounded-lg border border-gray-200 whitespace-pre-wrap"></div>
      </div>
      <button onclick="downloadResult()" class="mt-4 px-4 py-2 bg-gray-100 border rounded-md hover:bg-gray-200 text-sm font-semibold text-gray-700">çµæœã‚’ä¿å­˜</button>
    </div>

    <div id="error-message" class="hidden mt-8 p-4 bg-red-100 text-red-700 border border-red-200 rounded-lg">
      <span id="error-text"></span>
    </div>
  </div>

<script>
const ENDPOINTS = {
  gemini: "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent",
  openai: "https://api.openai.com/v1/chat/completions"
};

async function analyzeComment() {
  const comment = commentInput.value.trim();
  const apiKey = apiKeyInput.value.trim();
  const model = modelSelect.value;

  if (!apiKey) return showError("APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
  if (!comment) return showError("ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");

  setLoading(true);
  try {
    const prompt = generateSystemPrompt(comment, model);
    let responseData;

    if (model === "gemini") {
      const body = {
        contents: [{ parts: [{ text: comment }] }],
        systemInstruction: { parts: [{ text: prompt }] },
        generationConfig: {
          responseMimeType: "application/json",
          responseSchema: {
            type: "OBJECT",
            properties: {
              classification: { type: "STRING" },
              reasoning: { type: "STRING" },
              isGrounded: { type: "BOOLEAN" }
            },
            required: ["classification", "reasoning", "isGrounded"]
          }
        }
      };
      const res = await fetch(`${ENDPOINTS.gemini}?key=${apiKey}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });
      const data = await res.json();
      responseData = JSON.parse(data.candidates?.[0]?.content?.parts?.[0]?.text || "{}");
    } else {
      const openaiModel = model === "openai-4o" ? "gpt-4o-mini" : "gpt-3.5-turbo-0125";
      const res = await fetch(ENDPOINTS.openai, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${apiKey}`
        },
        body: JSON.stringify({
          model: openaiModel,
          messages: [
            { role: "system", content: prompt },
            { role: "user", content: comment }
          ],
          response_format: { type: "json_object" }
        })
      });

      if (!res.ok) {
        const errText = await res.text();
        throw new Error(`OpenAI APIã‚¨ãƒ©ãƒ¼ (${res.status}): ${errText}`);
      }

      const data = await res.json();
      if (!data.choices?.length) throw new Error("OpenAIã‹ã‚‰æœ‰åŠ¹ãªå¿œç­”ãŒè¿”ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚");
      responseData = JSON.parse(data.choices[0].message.content || "{}");
      responseData.isGrounded = false;
    }

    updateUI(responseData);
  } catch (err) {
    showError("åˆ†æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + err.message);
  } finally {
    setLoading(false);
  }
}

function generateSystemPrompt() {
  return `ã‚ãªãŸã¯SNSã‚³ãƒ¡ãƒ³ãƒˆã‚’ä»¥ä¸‹ã®5åˆ†é¡ã§è­˜åˆ¥ã™ã‚‹AIã§ã™:
1. çŠ¯ç½ªè¡Œç‚º/è„…è¿«
2. èª¹è¬—ä¸­å‚·/ãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆ
3. ãƒ•ã‚§ã‚¤ã‚¯ãƒ‹ãƒ¥ãƒ¼ã‚¹/èª¤æƒ…å ±
4. Bot/è‡ªå‹•ç”Ÿæˆ
5. å®‰å…¨/å•é¡Œãªã—
å‡ºåŠ›ã¯JSONå½¢å¼ã§ {"classification": "...", "reasoning": "...", "isGrounded": true/false} ã®ã¿è¿”ç­”ã€‚`;
}

function updateUI(a) {
  const classification = a.classification || "ä¸æ˜";
  const reasoning = a.reasoning || "ç†ç”±ãŒæä¾›ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚";
  classificationDisplay.className = "classification-tag";
  const map = {
    "çŠ¯ç½ªè¡Œç‚º/è„…è¿«": "color-crime",
    "èª¹è¬—ä¸­å‚·/ãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆ": "color-slander",
    "ãƒ•ã‚§ã‚¤ã‚¯ãƒ‹ãƒ¥ãƒ¼ã‚¹/èª¤æƒ…å ±": "color-fake",
    "Bot/è‡ªå‹•ç”Ÿæˆ": "color-bot",
    "å®‰å…¨/å•é¡Œãªã—": "color-safe"
  };
  classificationDisplay.classList.add(map[classification] || "color-safe");
  classificationDisplay.textContent = classification;
  reasoningDisplay.textContent = reasoning;
  resultsArea.classList.remove("hidden");
  errorMessage.classList.add("hidden");
}

function showError(msg) {
  errorText.textContent = msg;
  errorMessage.classList.remove("hidden");
}

function setLoading(b) {
  analyzeButton.disabled = b;
  loadingSpinner.classList.toggle("hidden", !b);
  buttonText.textContent = b ? "åˆ†æä¸­..." : "ã‚³ãƒ¡ãƒ³ãƒˆã‚’åˆ†æã™ã‚‹";
}

function downloadResult() {
  const content = `åˆ†é¡: ${classificationDisplay.textContent}\n\næ ¹æ‹ :\n${reasoningDisplay.textContent}`;
  const blob = new Blob([content], { type: "text/plain" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "åˆ†æçµæœ.txt";
  a.click();
}
</script>
</body>
</html>
